import { Meta, Story, Canvas } from '@storybook/addon-docs';
import GenericForm from './GenericForm';
import { HashRouter as Router } from 'react-router-dom';

export const choiceFormatter = (fieldId, res, otherOptions) => {
  console.log('choiceFormatter', fieldId, res, otherOptions);
  const { mappedId } = otherOptions || {};
  return res?.data?.data?.map((opt) => {
    console.log('opt', opt)
    // const id = mappedId && opt[mappedId] ? opt[mappedId] : opt.id || opt.streamID;
    return { id: opt['ID State'], label: `${opt['State']} - ${opt['Year']}`, ...opt }
  })
}

<Meta title="Form/GenericForm" component={GenericForm} />


# GenericForm

A `PamLayoutGrid` component takes a [PamLayout](/?path=/dataStructures/pamLayout) and a `data` as props. The `PamLayout` is used to define the columns and the `data` is used to populate the rows.

export const layout = {layout:{
  'data': {
    'create': '/api/grantApplication/new'
  },
  'id': 2,
  'modelId': 10,
  'enabled': true,
  'name': 'FD Grant Application',
  'editable': true,
  'layoutKey': 'new_fd',
  'type': 1,
  'sections': [
    {
      'editable': true,
      'enabled': true,
      'name': 'FD Grant Application',
      'order': 10,
      'layout': [
        {
          'label': 'State - Census Year',
          'path': 'stateCensusYear',
          'type': 10,
          'model': {
            'id': 5,
            'modelid': 10,
            'type': 2,
            'name': 'stateCensusYear',
            'data': {}
          },
          'required': true,
          'disabled': false,
          'url': 'https://datausa.io/api/data?drilldowns=State&measures=Population'
        },
        {
          'label': 'State ID',
          'path': 'stateId',
          'type': 0,
          'model': {
            'id': 8,
            'modelid': 10,
            'type': 0,
            'name': 'stateId',
            'data': {}
          },
          'required': false,
          'readOnly': true,
          'conditions': [
            {
              'then': {
                'renderPropertyId': 'ID State'
              },
              'when': 'stateCensusYear',
              'isValid': true
            }
          ]
        },
        {
          'label': 'Population',
          'path': 'population',
          'type': 0,
          'model': {
            'id': 7,
            'modelid': 10,
            'type': 0,
            'name': 'population',
            'data': {}
          },
          'required': false,
          'readOnly': true,
          'conditions': [
            {
              'then': {
                'renderPropertyId': 'Population'
              },
              'when': 'stateCensusYear',
              'isValid': true
            }
          ]
        },
        {
          'label': 'Date Application Received',
          'path': 'dateApplicationReceived',
          'type': 5,
          'model': {
            'id': 6,
            'modelid': 10,
            'type': 5,
            'name': 'dateApplicationReceived',
            'data': {}
          },
          'required': true,
          'disabled': false
        }
      ]
    }
  ]
}}

## No Data

When there is no data the columns will still be rendered but the data will say no rows. This can show wehn you have a data source that has no results.

<Canvas>
  <Story name="No Data">
  <Router>
    <GenericForm
        layoutOptions={layout}
        domainUrl={""}
        successUrl="/"
        cancelUrl="/"
        twoColumn={true}
        headerTitle="Request Access"
        unitLabel="Organization Access Request"
        formatSubmitMessage={() => 'Request submitted.'}
        helpText={() => null}
        asyncOptions={{choiceFormatter}}
        submitUrl={`/api/organization/joinRequest`}
      />
    </Router>
  </Story>
</Canvas>