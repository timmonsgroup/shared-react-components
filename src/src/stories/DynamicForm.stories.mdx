import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs';
import { ConfigForm } from './DynamicForm';
import { HashRouter as Router } from 'react-router-dom';
import { NestedThing } from './DynamicForm';
import { Paper, Grid } from '@mui/material';
import { layout } from '../helpers/story-helpers/FormLayoutPreset';

<Meta title="Form/ConfigForm" component={ConfigForm} />

export const formatPayload = (payload) => {
  window.alert('formatPayload: ' + JSON.stringify(payload));
  return payload;
};

export const choiceFormatter = (fieldId, res, otherOptions) => {
  const { mappedId } = otherOptions || {};
  return res?.data?.data?.map((opt) => {
    // const id = mappedId && opt[mappedId] ? opt[mappedId] : opt.id || opt.streamID;
    return {
      id: opt['ID State'],
      label: `${opt['State']} - ${opt['Year']}`,
      ...opt,
    };
  });
};

export const choiceFormatter2 = (fieldId, response, options) => {
  console.log('choiceFormatter', fieldId, response, options);
  const { data } = response || {};
  const choiceDataList = data.facts;
  const formattedChoices = choiceDataList.map((choiceDataItem, index) => {
      return { id: index, label: choiceDataItem };
  });

  return formattedChoices;
}

export const availColors = [
  'primary',
  'secondary',
  'tertiary',
  'accent',
  'grayscale',
  'success',
  'warning',
  'info',
  'regressive',
  'toggleBackground',
];

export const formArgs = {
  formTitle: {
    control: 'text',
    description:
      'The title of the form, this is only rendered on the first section',
  },
  defaultValues: { control: 'object' },
  layoutOptions: {
    control: 'object',
    description: 'An object containing the layout options',
  },
  twoColumn: {
    control: 'boolean',
    description: 'If true, the form will be displayed in two columns',
  },
  alternatingCols: {
    control: 'boolean',
    description: 'If true, the form will be displayed in alternating columns',
  },
  formatPayload: {
    control: 'function',
    description:'A function that will be called when the form is submitted. The function will be passed the payload as an argument and should return the payload.',
  },
  submitUrl: {
    actions: 'clicked',
    description: 'The url to submit the form to'
  },
  unitLabel: { control: 'text' },
  helpText: { control: 'text' },
  headerTitle: { control: 'text' },
  iconOptions: {
    control: 'object',
    description: 'An object containing the icon options',
  },
  submitColor: { control: 'select', options: availColors },
  cancelColor: { control: 'select', options: availColors },
  editColor: { control: 'select', options: availColors },
  hideEmptySections: { control: 'boolean' },
};

export const Template = (args) => {
  return (
    <Router>
      <div>
        <Grid id="top-row" container spacing={24}>
          <Grid item xs={4}>
            <Paper>Grid cell 1, 1</Paper>
          </Grid>
          <Grid item xs={4}>
            <Paper>Grid cell 2, 1</Paper>
          </Grid>
        </Grid>
        <Grid id="bottom-row" container spacing={24}>
          <Grid item xs={4}>
            <Paper>Grid cell 1, 2</Paper>
          </Grid>
          <Grid item xs={4}>
            <Paper>Grid cell 2, 2</Paper>
          </Grid>
        </Grid>
      </div>
      <ConfigForm
        formLayout={args.layoutOptions.layout} parseOptions={{choiceFormatter: choiceFormatter2}}
        data={{
          moMoney: 100,
          fireDepartment: '7409',
          anotherField: 1
        }}
      >
        <p> Am I A GAME? </p>
        <NestedThing />
      </ConfigForm>
    </Router>
  );
};

export const defaultProps = {
  layoutOptions: layout,
};

# ConfigForm

A `ConfigForm` component incorporates a PAM style form layout to render.

## Multi Section With Conditionals

This example shows how to use the `ConfigForm` component to render a multi section form with conditional fields.

<Canvas>
  <Story
    name="Multi Section With Conditionals"
    argTypes={formArgs}
    args={defaultProps}
  >
    {Template.bind({})}
  </Story>
</Canvas>
